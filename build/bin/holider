#!/usr/bin/env node
'use strict';

var _immutable = require('immutable');

var _index = require('../index');

var _index2 = _interopRequireDefault(_index);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var fs = require('fs');

var argv = require('minimist')(process.argv.slice(2));
var current_year = new Date().getFullYear();

if (argv.h || argv.help) {
  console.log('\n    --output\t\tabsolute path to file\tdefault=console.log\n    --year\t\t4 digit year\tdefault=' + current_year + '\n    --whitelist\t\tJSON array of holiday names\n    --date-format\t\tformat date using moment.js\tdefault=\'MM/DD/YYYY\'\n  ');

  process.exit();
}

var output_file = argv.output;
var year = argv.year || current_year;
var arg_list = argv.whitelist && (0, _immutable.List)(JSON.parse(argv.whitelist));
var whitelist = arg_list || _index.WHITELIST;
var date_format = argv['date-format'] || _index.DATE_FORMAT;

(0, _index2.default)(year, whitelist).then(function (result) {
  var text = JSON.stringify((0, _index.format_dates)(result, date_format), null, '\t');
  if (output_file) {
    fs.writeFileSync(output_file, text);
    if (!argv.quiet && !argv.q) console.log('output written to ' + output_file);
  } else {
    console.log(text);
  }
}).catch(function (e) {
  console.log(e);
  process.exit(1);
});